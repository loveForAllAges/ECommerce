{% extends 'base.html' %}
{% load my_filters %}


{% block content %}
<!-- <div class="fixed top-0 left-0 hidden h-full w-1/2 bg-white md:block"></div> -->
<!-- <div class="fixed top-0 right-0 hidden h-full w-1/2 bg-black md:block"></div> -->

<div class="relative mx-auto grid max-w-7xl grid-cols-1 gap-x-16 md:grid-cols-2 md:px-8 md:pt-16">
	<div class="py-12 md:col-start-2 md:row-start-1 md:mx-auto md:w-full md:max-w-lg md:bg-transparent md:px-0 md:pt-0 md:pb-24">
		<div class="mx-auto max-w-2xl px-4 lg:max-w-none lg:px-0">
			<div>
				<div class="text-sm text-gray-500">Итоговая стоимость</div>
				<div class="mt-1 text-3xl font-bold tracking-tight text-black">{{ total_price|add_space_separator }} ₽</div>
			</div>
			<ul class=" divide-y divide-gray-200">
				{% for product in cart %}
				<li class="flex group py-4 relative">
					<div class="h-20 w-20 flex-shrink-0 overflow-hidden rounded-md" href="{% url 'product' product.product.id %}">
					{% for image in product.product.productimage_set.all %}
					{% if image.is_main %}
						<img src="{{ image.image.url }}" class="h-full w-full object-cover object-center">
					{% endif %}
					{% endfor %}
					</div>
					<div class="flex flex-col flex-1 space-y-1 justify-between">
						<a href="{% url 'product' product.product.id %}" class="flex space-x-4">
							<span aria-hidden="true" class="absolute inset-0"></span>
							<div class="flex flex-col">
								<p class="duration-150 text-sm group-hover:text-blue-600">{{ product.product.name }}</p>
								<p class="mt-1 text-sm text-gray-500">{{ product.size }} размер</p>
								<p class="mt-1 text-sm text-gray-500">{{ product.quantity }} шт.</p>
							</div>
						</a>
					</div>
					
					<div class="flex flex-col justify-between items-end">
						<div class="ml-4 flex flex-col justify-between items-end">
							<p class="font-medium">{{ product.get_total_price|add_space_separator }} ₽</p>
							{% if product.quantity > 1 %}
							<p class="text-sm text-gray-500">1 шт. / {{ product.product.price|add_space_separator }} ₽</p>
							{% endif %}
						</div>
						<div class="flex justify-between">
							{% if product.product in request.user.wishlist.all %}
							<button type="button" data-product="{{ product.product.id }}" data-action="delete" class="isolate addToWishlist flex items-center justify-center bg-white p-1 text-rose-500 hover:text-rose-600">
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
									<path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"></path>
								</svg>
							</button>
							{% else %}
							<button type="button" {% if request.user.is_anonymous %}data-modal-target="permissionModal" data-modal-toggle="permissionModal"{% else %}data-product="{{ product.product.id }}" data-action="add"{% endif %} class="{% if request.user.is_authenticated %}addToWishlist{% endif %} isolate flex items-center justify-center bg-white p-1 text-gray-400 hover:text-gray-500">               
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
									<path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
								</svg>
							</button>
							{% endif %}
						</div>
					</div>
				</li>
				{% endfor %}
			</ul>

			<div class="space-y-6 border-t border-gray-200 pt-6 text-sm">
				<div class="flex items-center justify-between">
					<p class="font-medium text-gray-500">Подытог</p>
					<p>{{ total_price|add_space_separator }} ₽</p>
				</div>
				<div class="flex items-center justify-between">
					<p class="font-medium text-gray-500">Доставка</p>
					<p>{{ total_price|add_space_separator }} ₽</p>
				</div>
				<div class="flex items-center justify-between">
					<p class="font-medium text-gray-500">Скидка<span class="ml-2 rounded-full bg-gray-200 py-0.5 px-2 text-xs text-gray-600">STUDENT50</span></p>
					<p>{{ total_price|add_space_separator }} ₽</p>
				</div>

				<div class="flex items-center justify-between border-t border-gray-200 font-medium pt-6 text-black">
					<div class="text-base">Итого</div>
					<div class="text-base">{{ total_price|add_space_separator }} ₽</div>
				</div>
			</div>
		</div>
	</div>

	<div class="py-16 md:col-start-1 md:row-start-1 md:mx-auto md:w-full md:max-w-lg md:pt-0 md:pb-24">
		<form action="" method="POST">
		{% csrf_token %}
		<div class="mx-auto max-w-2xl px-4 lg:max-w-none lg:px-0">
			<div>
				<h3 class="text-lg font-medium text-gray-900">Персональные данные</h3>

				<div class="mt-6 grid grid-cols-2 gap-6">
					<div class="relative col-span-2 sm:col-span-1">
						<input {{disabled}} required type="text" id="first_name" name="first_name" autocomplete="first_name" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none focus:outline-none focus:ring-1 focus:ring-black focus:border-black peer disabled:cursor-not-allowed disabled:border-gray-200 disabled:text-gray-500" placeholder=" " value="{{ first_name }}" />
						<label for="first_name" class="absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white px-2 peer-focus:px-2 peer-focus:text-black peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">Имя</label>
					</div>
					<div class="relative col-span-2 sm:col-span-1">
						<input {{disabled}} required type="text" id="last_name" name="last_name" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none focus:outline-none focus:ring-1 focus:ring-black focus:border-black peer disabled:cursor-not-allowed disabled:border-gray-200 disabled:text-gray-500" placeholder=" " value="{{ last_name }}" />
						<label for="last_name" class="absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white px-2 peer-focus:px-2 peer-focus:text-black peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">Фамилия</label>
					</div>
					<div class="relative col-span-2 sm:col-span-1">
						<input {{disabled}} required type="text" id="phone" name="phone" autocomplete="phone" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none focus:outline-none focus:ring-1 focus:ring-black focus:border-black peer disabled:cursor-not-allowed disabled:border-gray-200 disabled:text-gray-500" placeholder=" " value="{{ phone }}" />
						<label for="phone" class="absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white px-2 peer-focus:px-2 peer-focus:text-black peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">Телефон</label>
					</div>
					<div class="relative col-span-2 sm:col-span-1">
						<input {{disabled}} required type="text" id="email" name="email" autocomplete="email" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none focus:outline-none focus:ring-1 focus:ring-black focus:border-black peer disabled:cursor-not-allowed disabled:border-gray-200 disabled:text-gray-500" placeholder=" " value="{{ email }}" />
						<label for="email" class="absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white px-2 peer-focus:px-2 peer-focus:text-black peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">Почта</label>
					</div>
				</div>
			</div>

			<div class="mt-10">
				<h3 class="text-lg font-medium text-gray-900">Тип доставки</h3>

				<div class="mt-6 -space-y-px rounded-lg bg-white">
					{% for delivery in delivery_types %}
					<label for="delivery-{{ delivery.id }}" class="rounded-tl-md rounded-tr-md duration-150 relative border p-4 flex cursor-pointer focus:outline-none hover:bg-gray-50 peer-checked:bg-gray-50">
						<input type="radio" required id="delivery-{{ delivery.id }}" {% if delivery.id == current_delivery %}checked{% endif %} name="delivery" value="{{ delivery.id }}" class="duration-150 mt-0.5 h-4 w-4 shrink-0 cursor-pointer text-blue-600 border-gray-300 focus:ring-blue-600">
						<span class="ml-3 w-full">
							<div class="flex justify-between text-sm">
								<div class="font-medium">{{ delivery.name }}</div>
								<div class="text-gray-500">{{ delivery.price }}</div>
							</div>
							<span class="text-sm text-gray-500">{{ delivery.description }}</span>
						</span>
					</label>
					{% endfor %}
				</div>
			</div>

			<div class="mt-10" id="address-form-part">
				<h3 class="text-lg font-medium text-gray-900">Адрес доставки</h3>

				<div class="mt-6 grid grid-cols-2 gap-6">
					<div class="relative col-span-2 sm:col-span-1">
						<input type="text" id="city" name="city" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none focus:outline-none focus:ring-1 focus:ring-black focus:border-black peer" placeholder=" " value="{{ city }}" />
						<label for="city" class="absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white px-2 peer-focus:px-2 peer-focus:text-black peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">Город</label>
					</div>
					<div class="relative col-span-2 sm:col-span-1">
						<input type="text" id="zip_code" name="zip_code" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none focus:outline-none focus:ring-1 focus:ring-black focus:border-black peer" placeholder=" " value="{{ zip_code }}" />
						<label for="zip_code" class="absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white px-2 peer-focus:px-2 peer-focus:text-black peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">Индекс</label>
					</div>
					<div class="relative col-span-2">
						<input type="text" id="address" name="address" autocomplete="address" class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-transparent rounded-lg border-1 border-gray-300 appearance-none focus:outline-none focus:ring-1 focus:ring-black focus:border-black peer" placeholder=" " value="{{ address }}" />
						<label for="address" class="absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white px-2 peer-focus:px-2 peer-focus:text-black peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">Адрес</label>
					</div>
				</div>
			</div>

			<div class="mt-10">
				<h3 class="text-lg font-medium text-gray-900">Дополнительно</h3>

				<label class="mt-6 relative inline-flex items-center cursor-pointer">
					<input type="checkbox" value="" name="advertising" class="sr-only peer" checked>
					<div class="w-11 h-6 bg-gray-200 duration-200 peer-focus:ring-0 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-0 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:shadow after:rounded-full after:h-5 after:w-5 after:ring-0 after:transition after:ease-in-out peer-checked:bg-blue-600"></div>
					<span class="ml-3 text-sm text-gray-900">Подписаться на рассылку новостей</span>
				</label>
			</div>

			<div class="mt-10 flex justify-end border-t border-gray-200 pt-6">
				<button type="submit" class="rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700">Оплатить</button>
			</div>
		</div>
		</form>
	</div>
</div>
{% endblock %}
